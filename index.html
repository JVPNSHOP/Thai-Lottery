<!DOCTYPE html>
<html lang="my">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>2D / 3D ရောင်းချက် • Reverse & Bulk</title>
  <style>
    :root{
      --bg:#0f172a; --panel:#0b1220; --ink:#e5e7eb; --soft:#9aa4b2;
      --line:rgba(255,255,255,.10); --cyan:#22d3ee; --sky:#38bdf8; --red:#ef4444; --ok:#10b981;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#081022,#0f172a 60%);color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Helvetica,Arial,"Noto Sans Myanmar",sans-serif}
    .wrap{max-width:1100px;margin:auto;padding:28px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
    h1{margin:0;font-size:20px}
    .badge{background:linear-gradient(90deg,var(--cyan),var(--sky));color:#001018;padding:6px 10px;border-radius:999px;font-weight:700;font-size:12px}
    .grid{display:grid;grid-template-columns:1.05fr .95fr;gap:16px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));border:1px solid var(--line);border-radius:16px;box-shadow:0 8px 20px rgba(0,0,0,.35)}
    .card .body{padding:16px}
    label{display:block;color:var(--soft);font-size:12px;margin:0 0 6px 6px}
    select,textarea,input{width:100%;padding:12px;border-radius:12px;border:1px solid var(--line);background:var(--panel);color:var(--ink);outline:none}
    textarea{min-height:92px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:760px){.row{grid-template-columns:1fr} .row2{grid-template-columns:1fr}}
    .switch{display:flex;align-items:center;gap:8px}
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    .btn{padding:12px 14px;border-radius:12px;border:1px solid var(--line);background:#1f2937;color:#fff;cursor:pointer}
    .btn:hover{filter:brightness(1.06)}
    .btn.primary{background:linear-gradient(90deg,var(--cyan),var(--sky));color:#001018;border:0;font-weight:800}
    .btn.ghost{background:transparent}
    .btn.danger{background:rgba(239,68,68,.12);border-color:rgba(239,68,68,.45);color:#fecaca}
    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    thead th{font-size:12px;color:var(--soft);text-align:left;padding:0 10px}
    tbody td{padding:10px;background:rgba(255,255,255,.03);border-top:1px solid var(--line);border-bottom:1px solid var(--line);vertical-align:middle}
    tbody tr td:first-child{border-left:1px solid var(--line);border-top-left-radius:12px;border-bottom-left-radius:12px}
    tbody tr td:last-child{border-right:1px solid var(--line);border-top-right-radius:12px;border-bottom-right-radius:12px}
    .priceCell input{width:110px}
    .pill{padding:4px 8px;border-radius:999px;border:1px solid var(--line);background:rgba(255,255,255,.05);font-size:12px}
    .stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
    @media (max-width:980px){.stats{grid-template-columns:1fr}}
    .stat{padding:14px;border:1px solid var(--line);border-radius:14px;background:rgba(34,211,238,.06)}
    .stat h3{margin:0 0 6px 0;font-size:12px;color:#bfe1ff}
    .stat .v{font-size:22px;font-weight:800}
    footer{margin-top:16px;color:var(--soft);font-size:12px;text-align:center}
    /* Voucher */
    .voucher .sheet{background:#fff;color:#111;border-radius:14px;border:1px solid #e5e7eb;overflow:hidden}
    .voucher header{background:#e0f2fe;color:#082f49;padding:10px 14px;display:flex;justify-content:space-between}
    .voucher .content{padding:14px}
    .voucher table{width:100%;border-collapse:collapse}
    .voucher th,.voucher td{padding:8px;border-bottom:1px dashed #e5e7eb;text-align:left;color:#111}
    .right{text-align:right}
    @media print{
      body{background:#fff}
      header,.grid footer,.actions .btn:not(.print){display:none}
      .voucher .sheet{box-shadow:none;border:0;border-radius:0}
      .wrap{padding:0;max-width:none}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>2D / 3D ရောင်းချက် (Reverse & Bulk)</h1>
      <span class="badge">Bulk + Reverse + Voucher</span>
    </header>

    <div class="grid">
      <!-- LEFT: Inputs -->
      <section class="card">
        <div class="body">
          <div class="row2">
            <div>
              <label>အမျိုးအစား</label>
              <select id="game">
                <option value="2D">2D</option>
                <option value="3D">3D</option>
              </select>
            </div>
            <div id="twoDOptWrap">
              <label>2D Option</label>
              <select id="twoDOpt">
                <option value="TOP">အပေါ်</option>
                <option value="BOTTOM">အောက်</option>
                <option value="BOTH">အပေါ် + အောက်</option>
              </select>
            </div>
            <div id="threeDOptWrap" style="display:none">
              <label>3D Option</label>
              <select id="threeDOpt">
                <option value="STRAIGHT">Straight (တစ်ခု)</option>
                <option value="PERM6">Permute 6-way (တြတ်သုံးလုံး)</option>
              </select>
            </div>
            <div class="switch">
              <input type="checkbox" id="reverseToggle">
              <label for="reverseToggle">Reverse ထည့် (2D: 12↔21, 3D: PERM6 ကိုသုံးပါ)</label>
            </div>
          </div>

          <div style="margin-top:10px">
            <label>Numbers (space/comma/newline ဖြင့် အများကြီး ထည့်ပါ)</label>
            <textarea id="bulk" placeholder="ဥပမာ:\n2D — 12 34 56\n3D — 123, 456, 789"></textarea>
          </div>

          <div class="actions" style="margin-top:10px">
            <button class="btn primary" id="btnAdd">Add Numbers</button>
            <button class="btn ghost" id="btnSample">Sample ထည့်</button>
            <button class="btn danger" id="btnClearAll">Clear All</button>
          </div>

          <p class="pill" style="margin-top:10px">ဂဏန်းတခုစီမှာ ထိုးကြေး/ဈေးကို အောက်က ဇယားထဲမှာ တစ်ခုချင်း ပြင်နိုင်ပါတယ်</p>
        </div>
      </section>

      <!-- RIGHT: Stats -->
      <aside class="card">
        <div class="body">
          <h3 style="margin-top:0">အနှစ်ချုပ်</h3>
          <div class="stats">
            <div class="stat">
              <h3>ထည့်သွင်းထားသော ဂဏန်း</h3>
              <div class="v" id="statNums">0</div>
            </div>
            <div class="stat">
              <h3>စျေးအိုင်တမ် (expand ပါဝင်)</h3>
              <div class="v" id="statItems">0</div>
            </div>
            <div class="stat">
              <h3>စုစုပေါင်းငွေ (MMK)</h3>
              <div class="v" id="statTotal">0</div>
            </div>
          </div>
        </div>
      </aside>
    </div>

    <!-- Items Table -->
    <section class="card" style="margin-top:14px">
      <div class="body">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Game</th>
              <th>Number</th>
              <th>Detail</th>
              <th class="right">Price (MMK)</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </section>

    <!-- Voucher -->
    <section class="voucher" style="margin-top:14px">
      <div class="sheet">
        <header>
          <strong>ရောင်းချေမှု ဘောင်ချာ</strong>
          <span id="vDate">-</span>
        </header>
        <div class="content">
          <p style="margin:0 0 8px 0"><span id="vId" class="pill">Voucher: -</span></p>
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Game</th>
                <th>Number</th>
                <th>Detail</th>
                <th class="right">Price (MMK)</th>
              </tr>
            </thead>
            <tbody id="vBody"></tbody>
            <tfoot>
              <tr>
                <td colspan="4" class="right" style="font-weight:700">စုစုပေါင်း</td>
                <td class="right" id="vTotal" style="font-weight:700">0</td>
              </tr>
            </tfoot>
          </table>
          <div class="actions" style="margin-top:8px">
            <button class="btn primary print" onclick="window.print()">Print / Save PDF</button>
          </div>
        </div>
      </div>
    </section>

    <footer>© 2025 • 2D/3D • Reverse • Bulk Input • Local Only</footer>
  </div>

  <script>
    const $ = (id)=>document.getElementById(id);
    const fmt = (n)=>Number(n||0).toLocaleString('en-US');

    const state = { rows: [] }; // {game, number, detail, price}

    const game = $('game');
    const twoDOptWrap = $('twoDOptWrap');
    const threeDOptWrap = $('threeDOptWrap');
    const twoDOpt = $('twoDOpt');
    const threeDOpt = $('threeDOpt');
    const reverseToggle = $('reverseToggle');

    const bulk = $('bulk');
    const btnAdd = $('btnAdd');
    const btnSample = $('btnSample');
    const btnClearAll = $('btnClearAll');

    const tbody = $('tbody');
    const statNums = $('statNums');
    const statItems = $('statItems');
    const statTotal = $('statTotal');

    const vBody = $('vBody');
    const vTotal = $('vTotal');
    const vDate = $('vDate');
    const vId = $('vId');

    function setModeUI(){
      const is2D = game.value==='2D';
      twoDOptWrap.style.display = is2D ? 'block' : 'none';
      threeDOptWrap.style.display = is2D ? 'none' : 'block';
      reverseToggle.disabled = !is2D; // 3D reverse handled by PERM6
      reverseToggle.title = is2D ? '2D Reverse toggle' : '3D မှာ PERM6 ကိုအသုံးပြုပါ';
    }
    game.onchange = setModeUI; setModeUI();

    function parseNumbers(raw){
      const list = raw.split(/[^0-9]+/).filter(Boolean);
      const is2D = game.value==='2D';
      const wanted = is2D ? 2 : 3;
      const cleaned = list.filter(n=>n.length===wanted).map(n=>n.slice(0,wanted));
      // unique while preserving order
      const seen = new Set(), out=[];
      for(const n of cleaned){ if(!seen.has(n)){ seen.add(n); out.push(n);} }
      return out;
    }

    function addRowsFromBulk(){
      const nums = parseNumbers(bulk.value);
      if(nums.length===0){ alert('ထည့်မည့် ဂဏန်းတွေ (အလိုက်စား digit) မတွေ့ပါ'); return; }

      const is2D = game.value==='2D';
      const opt2D = twoDOpt.value;       // TOP/BOTTOM/BOTH
      const opt3D = threeDOpt.value;     // STRAIGHT/PERM6
      const wantReverse = reverseToggle.checked;

      // For stats: how many primary numbers entered
      const primaryCount = nums.length;

      for(const n of nums){
        if(is2D){
          // 2D - create rows per option
          if(opt2D==='TOP' || opt2D==='BOTH'){
            pushRow('2D', n, 'အပေါ်', 0);
          }
          if(opt2D==='BOTTOM' || opt2D==='BOTH'){
            pushRow('2D', n, 'အောက်', 0);
          }
          if(wantReverse){
            const r = n.split('').reverse().join('');
            if(opt2D==='TOP' || opt2D==='BOTH'){
              pushRow('2D', r, 'အပေါ် (Reverse)', 0);
            }
            if(opt2D==='BOTTOM' || opt2D==='BOTH'){
              pushRow('2D', r, 'အောက် (Reverse)', 0);
            }
          }
        } else {
          // 3D
          if(opt3D==='STRAIGHT'){
            pushRow('3D', n, 'Straight', 0);
          } else {
            // PERM6 - generate 6 unique permutations
            const perms = permute3(n);
            for(const p of perms){ pushRow('3D', p, 'Perm6', 0); }
          }
        }
      }

      // small UX: clear textarea
      bulk.value = '';
      refresh(primaryCount);
    }

    function pushRow(game, number, detail, price){
      state.rows.push({game, number, detail, price:Number(price||0)});
    }

    function permute3(n){
      const a=n[0], b=n[1], c=n[2];
      const arr=[a+b+c,a+c+b,b+a+c,b+c+a,c+a+b,c+b+a];
      // de-dup
      const set=new Set(arr);
      return [...set];
    }

    function refresh(addedPrimary=0){
      // table body
      tbody.innerHTML = '';
      state.rows.forEach((row,i)=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `
          <td>${i+1}</td>
          <td>${row.game}</td>
          <td><strong>${row.number}</strong></td>
          <td>${row.detail}</td>
          <td class="right priceCell"><input type="number" min="0" value="${row.price}" data-i="${i}" /></td>
          <td class="right"><button class="btn danger" data-del="${i}">ဖျက်</button></td>
        `;
        tbody.appendChild(tr);
      });

      // bind price edits
      tbody.querySelectorAll('input[type="number"][data-i]')
        .forEach(inp=>{
          inp.oninput = (e)=>{
            const i=Number(e.target.dataset.i);
            state.rows[i].price = Number(e.target.value||0);
            drawVoucherAndStats();
          };
        });

      // bind delete
      tbody.querySelectorAll('button[data-del]').forEach(btn=>{
        btn.onclick=()=>{
          const i=Number(btn.dataset.del);
          state.rows.splice(i,1);
          refresh();
        };
      });

      drawVoucherAndStats(addedPrimary);
    }

    function drawVoucherAndStats(addedPrimary=0){
      // stats
      const numsUnique = new Set(state.rows.map(r=>r.number)).size;
      const items = state.rows.length;
      const total = state.rows.reduce((a,c)=>a+Number(c.price||0),0);
      statNums.textContent = fmt(numsUnique);
      statItems.textContent = fmt(items);
      statTotal.textContent = fmt(total);

      // voucher
      vBody.innerHTML='';
      state.rows.forEach((r,i)=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `
          <td>${i+1}</td>
          <td>${r.game}</td>
          <td>${r.number}</td>
          <td>${r.detail}</td>
          <td class="right">${fmt(r.price)}</td>
        `;
        vBody.appendChild(tr);
      });
      vTotal.textContent = fmt(total);
      const now=new Date();
      vDate.textContent = now.toLocaleString();
      // simple id reflecting current count
      vId.textContent = `V-${String(now.getFullYear()).slice(-2)}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}-${String(items).padStart(3,'0')}`;
    }

    // Events
    btnAdd.onclick = addRowsFromBulk;
    btnClearAll.onclick = ()=>{
      if(confirm('အားလုံးဖျက်မလား?')){
        state.rows.splice(0,state.rows.length);
        refresh();
      }
    };
    btnSample.onclick = ()=>{
      if(game.value==='2D'){ bulk.value = "12 34 56, 78 90"; twoDOpt.value='BOTH'; reverseToggle.checked=true; }
      else { bulk.value = "123 456, 789"; threeDOpt.value='PERM6'; }
    };

    // Keyboard: Ctrl/Cmd+Enter to add
    bulk.addEventListener('keydown', (e)=>{
      if((e.metaKey||e.ctrlKey) && e.key==='Enter'){ e.preventDefault(); addRowsFromBulk(); }
    });

    // Init
    refresh();
  </script>
</body>
</html>
